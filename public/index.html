<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX with Node Express Server</title>
    <style>
        .btn {
            border: 1px solid black;
            padding: 5px;
            display: inline-block;
        }
    </style>
</head>

<body>
    <h1>Hello,World!</h1>
    <ul id="usersList"></ul>
    <form id="myform">
        <input type="text" name="user" placeholder="User Name">
        <input type="password" name="pass" placeholder="Password">
    </form>
    <div class="btn">Click Me</div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        class MyCRUD {

            constructor() {
                this.usersList = $('#usersList');
                this.myform = $('#myform');
                this.btn = $('.btn');

                //read
                this.buildPage();
                this.events();
            }
            events() {
                //register eventListener
                //create
                this.btn.on('click', this.createUser.bind(this));
                //delete
                this.usersList.on('click', '.remove', this.deleteUser.bind(this));


            }
            //delete
            deleteUser(e) {
                let id = $(e.target).parent().data('id');
                console.log(id);

                $.ajax({
                    url: '/users/' + id,
                    type: 'DELETE'
                }).done(res => {
                    console.log(res);
                    this.buildPage();
                });
            }
            //create
            createUser() {
                // let user = $('input[name="user"]').val();
                // let pass = $('input[name="pass"]').val();
                $.post('/users', this.myform.serialize()).done(data => {
                    console.log(data);
                    this.buildPage();
                });

            }
            //read
            buildPage() {
                this.usersList.html('');
                $.getJSON('/users', (data) => {
                    $.each(data.users, (i, value) => {
                        let hLink = '<a href="/users/' + value.id + '" target="_blank">' +
                            value
                            .id +
                            '</a>';
                        let newList = $('<li>User: ' + value.user + ' ' + hLink +
                            '<span class="remove">x</span></li>');
                        newList.data('id', value.id);
                        this.usersList.append(newList);
                    });
                });


            }
        }
        const crud = new MyCRUD();
    </script>

</body>

</html>